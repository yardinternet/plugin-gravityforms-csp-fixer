(function(d){typeof define=="function"&&define.amd?define(d):d()})(function(){"use strict";var d="INUMBER",I="IOP1",P="IOP2",S="IOP3",M="IVAR",b="IVARNAME",N="IFUNCALL",Q="IFUNDEF",E="IEXPR",X="IEXPREVAL",k="IMEMBER",D="IENDSTATEMENT",R="IARRAY";function p(e,t){this.type=e,this.value=t??0}p.prototype.toString=function(){switch(this.type){case d:case I:case P:case S:case M:case b:case D:return this.value;case N:return"CALL "+this.value;case Q:return"DEF "+this.value;case R:return"ARRAY "+this.value;case k:return"."+this.value;default:return"Invalid Instruction"}};function V(e){return new p(I,e)}function A(e){return new p(P,e)}function re(e){return new p(S,e)}function H(e,t,r,n,s){for(var i=[],a=[],u,h,v,l,f=0;f<e.length;f++){var o=e[f],y=o.type;if(y===d||y===b)Array.isArray(o.value)?i.push.apply(i,H(o.value.map(function(C){return new p(d,C)}).concat(new p(R,o.value.length)),t,r,n,s)):i.push(o);else if(y===M&&s.hasOwnProperty(o.value))o=new p(d,s[o.value]),i.push(o);else if(y===P&&i.length>1)h=i.pop(),u=i.pop(),l=r[o.value],o=new p(d,l(u.value,h.value)),i.push(o);else if(y===S&&i.length>2)v=i.pop(),h=i.pop(),u=i.pop(),o.value==="?"?i.push(u.value?h.value:v.value):(l=n[o.value],o=new p(d,l(u.value,h.value,v.value)),i.push(o));else if(y===I&&i.length>0)u=i.pop(),l=t[o.value],o=new p(d,l(u.value)),i.push(o);else if(y===E){for(;i.length>0;)a.push(i.shift());a.push(new p(E,H(o.value,t,r,n,s)))}else if(y===k&&i.length>0)u=i.pop(),i.push(new p(d,u.value[o.value]));else{for(;i.length>0;)a.push(i.shift());a.push(o)}}for(;i.length>0;)a.push(i.shift());return a}function ne(e,t,r){for(var n=[],s=0;s<e.length;s++){var i=e[s],a=i.type;if(a===M&&i.value===t)for(var u=0;u<r.tokens.length;u++){var h=r.tokens[u],v;h.type===I?v=V(h.value):h.type===P?v=A(h.value):h.type===S?v=re(h.value):v=new p(h.type,h.value),n.push(v)}else a===E?n.push(new p(E,ne(i.value,t,r))):n.push(i)}return n}function _(e,t,r){var n=[],s,i,a,u,h,v;if(Y(e))return O(e,r);for(var l=e.length,f=0;f<l;f++){var o=e[f],y=o.type;if(y===d||y===b)n.push(o.value);else if(y===P)i=n.pop(),s=n.pop(),o.value==="and"?n.push(s?!!_(i,t,r):!1):o.value==="or"?n.push(s?!0:!!_(i,t,r)):o.value==="="?(u=t.binaryOps[o.value],n.push(u(s,_(i,t,r),r))):(u=t.binaryOps[o.value],n.push(u(O(s,r),O(i,r))));else if(y===S)a=n.pop(),i=n.pop(),s=n.pop(),o.value==="?"?n.push(_(s?i:a,t,r)):(u=t.ternaryOps[o.value],n.push(u(O(s,r),O(i,r),O(a,r))));else if(y===M)if(o.value in t.functions)n.push(t.functions[o.value]);else if(o.value in t.unaryOps&&t.parser.isOperatorEnabled(o.value))n.push(t.unaryOps[o.value]);else{var C=r[o.value];if(C!==void 0)n.push(C);else throw new Error("undefined variable: "+o.value)}else if(y===I)s=n.pop(),u=t.unaryOps[o.value],n.push(u(O(s,r)));else if(y===N){for(v=o.value,h=[];v-- >0;)h.unshift(O(n.pop(),r));if(u=n.pop(),u.apply&&u.call)n.push(u.apply(void 0,h));else throw new Error(u+" is not a function")}else if(y===Q)n.push(function(){for(var q=n.pop(),L=[],lt=o.value;lt-- >0;)L.unshift(n.pop());var ve=n.pop(),te=function(){for(var ge=Object.assign({},r),$=0,ft=L.length;$<ft;$++)ge[L[$]]=arguments[$];return _(q,t,ge)};return Object.defineProperty(te,"name",{value:ve,writable:!1}),r[ve]=te,te}());else if(y===E)n.push(ye(o,t));else if(y===X)n.push(o);else if(y===k)s=n.pop(),n.push(s[o.value]);else if(y===D)n.pop();else if(y===R){for(v=o.value,h=[];v-- >0;)h.unshift(n.pop());n.push(h)}else throw new Error("invalid Expression")}if(n.length>1)throw new Error("invalid Expression (parity)");return n[0]===0?0:O(n[0],r)}function ye(e,t,r){return Y(e)?e:{type:X,value:function(n){return _(e.value,t,n)}}}function Y(e){return e&&e.type===X}function O(e,t){return Y(e)?e.value(t):e}function z(e,t){for(var r=[],n,s,i,a,u,h,v=0;v<e.length;v++){var l=e[v],f=l.type;if(f===d)typeof l.value=="number"&&l.value<0?r.push("("+l.value+")"):Array.isArray(l.value)?r.push("["+l.value.map(se).join(", ")+"]"):r.push(se(l.value));else if(f===P)s=r.pop(),n=r.pop(),a=l.value,t?a==="^"?r.push("Math.pow("+n+", "+s+")"):a==="and"?r.push("(!!"+n+" && !!"+s+")"):a==="or"?r.push("(!!"+n+" || !!"+s+")"):a==="||"?r.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+n+"),("+s+")))"):a==="=="?r.push("("+n+" === "+s+")"):a==="!="?r.push("("+n+" !== "+s+")"):a==="["?r.push(n+"[("+s+") | 0]"):r.push("("+n+" "+a+" "+s+")"):a==="["?r.push(n+"["+s+"]"):r.push("("+n+" "+a+" "+s+")");else if(f===S)if(i=r.pop(),s=r.pop(),n=r.pop(),a=l.value,a==="?")r.push("("+n+" ? "+s+" : "+i+")");else throw new Error("invalid Expression");else if(f===M||f===b)r.push(l.value);else if(f===I)n=r.pop(),a=l.value,a==="-"||a==="+"?r.push("("+a+n+")"):t?a==="not"?r.push("(!"+n+")"):a==="!"?r.push("fac("+n+")"):r.push(a+"("+n+")"):a==="!"?r.push("("+n+"!)"):r.push("("+a+" "+n+")");else if(f===N){for(h=l.value,u=[];h-- >0;)u.unshift(r.pop());a=r.pop(),r.push(a+"("+u.join(", ")+")")}else if(f===Q){for(s=r.pop(),h=l.value,u=[];h-- >0;)u.unshift(r.pop());n=r.pop(),t?r.push("("+n+" = function("+u.join(", ")+") { return "+s+" })"):r.push("("+n+"("+u.join(", ")+") = "+s+")")}else if(f===k)n=r.pop(),r.push(n+"."+l.value);else if(f===R){for(h=l.value,u=[];h-- >0;)u.unshift(r.pop());r.push("["+u.join(", ")+"]")}else if(f===E)r.push("("+z(l.value,t)+")");else if(f!==D)throw new Error("invalid Expression")}return r.length>1&&(t?r=[r.join(",")]:r=[r.join(";")]),String(r[0])}function se(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function F(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function K(e,t,r){r=r||{};for(var n=!!r.withMembers,s=null,i=0;i<e.length;i++){var a=e[i];a.type===M||a.type===b?!n&&!F(t,a.value)?t.push(a.value):(s!==null&&(F(t,s)||t.push(s)),s=a.value):a.type===k&&n&&s!==null?s+="."+a.value:a.type===E?K(a.value,t,r):s!==null&&(F(t,s)||t.push(s),s=null)}s!==null&&!F(t,s)&&t.push(s)}function x(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}x.prototype.simplify=function(e){return e=e||{},new x(H(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},x.prototype.substitute=function(e,t){return t instanceof x||(t=this.parser.parse(String(t))),new x(ne(this.tokens,e,t),this.parser)},x.prototype.evaluate=function(e){return e=e||{},_(this.tokens,this,e)},x.prototype.toString=function(){return z(this.tokens,!1)},x.prototype.symbols=function(e){e=e||{};var t=[];return K(this.tokens,t,e),t},x.prototype.variables=function(e){e=e||{};var t=[];K(this.tokens,t,e);var r=this.functions;return t.filter(function(n){return!(n in r)})},x.prototype.toJSFunction=function(e,t){var r=this,n=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+z(this.simplify(t).tokens,!0)+"; }");return function(){return n.apply(r,arguments)}};var U="TEOF",c="TOP",B="TNUMBER",ie="TSTRING",T="TPAREN",j="TBRACKET",G="TCOMMA",W="TNAME",J="TSEMICOLON";function ae(e,t,r){this.type=e,this.value=t,this.index=r}ae.prototype.toString=function(){return this.type+": "+this.value};function w(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}w.prototype.newToken=function(e,t,r){return new ae(e,t,r??this.pos)},w.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},w.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},w.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(U,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},w.prototype.isString=function(){var e=!1,t=this.pos,r=this.expression.charAt(t);if(r==="'"||r==='"')for(var n=this.expression.indexOf(r,t+1);n>=0&&this.pos<this.expression.length;){if(this.pos=n+1,this.expression.charAt(n-1)!=="\\"){var s=this.expression.substring(t+1,n);this.current=this.newToken(ie,this.unescape(s),t),e=!0;break}n=this.expression.indexOf(r,n+1)}return e},w.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(T,e),this.pos++,!0):!1},w.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(j,e),this.pos++,!0):!1},w.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(G,","),this.pos++,!0):!1},w.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(J,";"),this.pos++,!0):!1},w.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&r!=="."&&(r<"0"||r>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(n in this.consts)return this.current=this.newToken(B,this.consts[n]),this.pos+=n.length,!0}return!1},w.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&(r<"0"||r>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(this.isOperatorEnabled(n)&&(n in this.binaryOps||n in this.unaryOps||n in this.ternaryOps))return this.current=this.newToken(c,n),this.pos+=n.length,!0}return!1},w.prototype.isName=function(){for(var e=this.pos,t=e,r=!1;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()){if(t===this.pos&&(n==="$"||n==="_")){n==="_"&&(r=!0);continue}else if(t===this.pos||!r||n!=="_"&&(n<"0"||n>"9"))break}else r=!0}if(r){var s=this.expression.substring(e,t);return this.current=this.newToken(W,s),this.pos+=s.length,!0}return!1},w.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var we=/^[0-9a-f]{4}$/i;w.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var r=e.substring(0,t);t>=0;){var n=e.charAt(++t);switch(n){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;case"u":var s=e.substring(t+1,t+5);we.test(s)||this.parseError("Illegal escape sequence: \\u"+s),r+=String.fromCharCode(parseInt(s,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+n+'"')}++t;var i=e.indexOf("\\",t);r+=e.substring(t,i<0?e.length:i),t=i}return r},w.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},w.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,r;if(this.expression.charAt(e)==="x")t=16,r=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,r=/^[01]$/i,++e;else return!1;for(var n=!1,s=e;e<this.expression.length;){var i=this.expression.charAt(e);if(r.test(i))e++,n=!0;else break}return n&&(this.current=this.newToken(B,parseInt(this.expression.substring(s,e),t)),this.pos=e),n},w.prototype.isNumber=function(){for(var e=!1,t=this.pos,r=t,n=t,s=!1,i=!1,a;t<this.expression.length&&(a=this.expression.charAt(t),a>="0"&&a<="9"||!s&&a===".");)a==="."?s=!0:i=!0,t++,e=i;if(e&&(n=t),a==="e"||a==="E"){t++;for(var u=!0,h=!1;t<this.expression.length;){if(a=this.expression.charAt(t),u&&(a==="+"||a==="-"))u=!1;else if(a>="0"&&a<="9")h=!0,u=!1;else break;t++}h||(t=n)}return e?(this.current=this.newToken(B,parseFloat(this.expression.substring(r,t))),this.pos=t):this.pos=n,e},w.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(c,t);else if(t==="∙"||t==="•")this.current=this.newToken(c,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,">="),this.pos++):this.current=this.newToken(c,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,"<="),this.pos++):this.current=this.newToken(c,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(c,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,"=="),this.pos++):this.current=this.newToken(c,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,"!="),this.pos++):this.current=this.newToken(c,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)},w.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)},w.prototype.getCoordinates=function(){var e=0,t,r=-1;do e++,t=this.pos-r,r=this.expression.indexOf(`
`,r+1);while(r>=0&&r<this.pos);return{line:e,column:t}},w.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function g(e,t,r){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=r.allowMemberAccess!==!1}g.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},g.prototype.tokenMatches=function(e,t){return typeof t>"u"?!0:Array.isArray(t)?F(t,e.value):typeof t=="function"?t(e):e.value===t},g.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},g.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},g.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1},g.prototype.expect=function(e,t){if(!this.accept(e,t)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(t||e))}},g.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function r(s){return s.value in t}if(this.accept(W)||this.accept(c,r))e.push(new p(M,this.current.value));else if(this.accept(B))e.push(new p(d,this.current.value));else if(this.accept(ie))e.push(new p(d,this.current.value));else if(this.accept(T,"("))this.parseExpression(e),this.expect(T,")");else if(this.accept(j,"["))if(this.accept(j,"]"))e.push(new p(R,0));else{var n=this.parseArrayList(e);e.push(new p(R,n))}else throw new Error("unexpected "+this.nextToken)},g.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))},g.prototype.pushExpression=function(e,t){for(var r=0,n=t.length;r<n;r++)e.push(t[r])},g.prototype.parseUntilEndStatement=function(e,t){return this.accept(J)?(this.nextToken&&this.nextToken.type!==U&&!(this.nextToken.type===T&&this.nextToken.value===")")&&t.push(new p(D)),this.nextToken.type!==U&&this.parseExpression(t),e.push(new p(E,t)),!0):!1},g.prototype.parseArrayList=function(e){for(var t=0;!this.accept(j,"]");)for(this.parseExpression(e),++t;this.accept(G);)this.parseExpression(e),++t;return t},g.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(c,"=");){var t=e.pop(),r=[],n=e.length-1;if(t.type===N){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var s=0,i=t.value+1;s<i;s++){var a=n-s;e[a].type===M&&(e[a]=new p(b,e[a].value))}this.parseVariableAssignmentExpression(r),e.push(new p(E,r)),e.push(new p(Q,t.value));continue}if(t.type!==M&&t.type!==k)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),e.push(new p(b,t.value)),e.push(new p(E,r)),e.push(A("="))}},g.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(c,"?");){var t=[],r=[];this.parseConditionalExpression(t),this.expect(c,":"),this.parseConditionalExpression(r),e.push(new p(E,t)),e.push(new p(E,r)),e.push(re("?"))}},g.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(c,"or");){var t=[];this.parseAndExpression(t),e.push(new p(E,t)),e.push(A("or"))}},g.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(c,"and");){var t=[];this.parseComparison(t),e.push(new p(E,t)),e.push(A("and"))}};var de=["==","!=","<","<=",">=",">","in"];g.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(c,de);){var t=this.current;this.parseAddSub(e),e.push(A(t.value))}};var Ee=["+","-","||"];g.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(c,Ee);){var t=this.current;this.parseTerm(e),e.push(A(t.value))}};var xe=["*","/","%"];g.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(c,xe);){var t=this.current;this.parseFactor(e),e.push(A(t.value))}},g.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function r(s){return s.value in t}if(this.save(),this.accept(c,r)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===T&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===J||this.nextToken.type===G||this.nextToken.type===U||this.nextToken.type===T&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var n=this.current;this.parseFactor(e),e.push(V(n.value))}else this.parseExponential(e)},g.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(c,"^");)this.parseFactor(e),e.push(A("^"))},g.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(c,"!");)e.push(V("!"))},g.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function r(i){return i.value in t}if(this.accept(c,r)){var n=this.current;this.parseAtom(e),e.push(V(n.value))}else for(this.parseMemberExpression(e);this.accept(T,"(");)if(this.accept(T,")"))e.push(new p(N,0));else{var s=this.parseArgumentList(e);e.push(new p(N,s))}},g.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(T,")");)for(this.parseExpression(e),++t;this.accept(G);)this.parseExpression(e),++t;return t},g.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(c,".")||this.accept(j,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(W),e.push(new p(k,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(j,"]"),e.push(A("["))}else throw new Error("unexpected symbol: "+t.value)}};function Me(e,t){return Number(e)+Number(t)}function Ae(e,t){return e-t}function Oe(e,t){return e*t}function Te(e,t){return e/t}function be(e,t){return e%t}function ke(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function _e(e,t){return e===t}function me(e,t){return e!==t}function Ce(e,t){return e>t}function Ie(e,t){return e<t}function Pe(e,t){return e>=t}function Se(e,t){return e<=t}function Ne(e,t){return!!(e&&t)}function Re(e,t){return!!(e||t)}function Fe(e,t){return F(t,e)}function je(e){return(Math.exp(e)-Math.exp(-e))/2}function Le(e){return(Math.exp(e)+Math.exp(-e))/2}function Ue(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function qe(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function Qe(e){return Math.log(e+Math.sqrt(e*e-1))}function De(e){return Math.log((1+e)/(1-e))/2}function oe(e){return Math.log(e)*Math.LOG10E}function Ve(e){return-e}function Be(e){return!e}function Ge(e){return e<0?Math.ceil(e):Math.floor(e)}function $e(e){return Math.random()*(e||1)}function ue(e){return ee(e+1)}function Xe(e){return isFinite(e)&&e===Math.round(e)}var He=4.7421875,Z=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function ee(e){var t,r;if(Xe(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var n=e-2,s=e-1;n>1;)s*=n,n--;return s===0&&(s=1),s}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*ee(1-e));if(e>=171.35)return 1/0;if(e>85){var i=e*e,a=i*e,u=a*e,h=u*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*i)-139/(51840*a)-571/(2488320*u)+163879/(209018880*h)+5246819/(75246796800*h*e))}--e,r=Z[0];for(var v=1;v<Z.length;++v)r+=Z[v]/(e+v);return t=e+He+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*r}function Ye(e){return Array.isArray(e)?e.length:String(e).length}function he(){for(var e=0,t=0,r=0;r<arguments.length;r++){var n=Math.abs(arguments[r]),s;t<n?(s=t/n,e=e*s*s+1,t=n):n>0?(s=n/t,e+=s*s):e+=n}return t===1/0?1/0:t*Math.sqrt(e)}function pe(e,t,r){return e?t:r}function ze(e,t){return typeof t>"u"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function Ke(e,t,r){return r&&(r[e]=t),t}function We(e,t){return e[t|0]}function Je(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function Ze(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function et(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(r,n){return e(r,n)})}function tt(e,t,r){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce(function(n,s,i){return e(n,s,i)},t)}function rt(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(r,n){return e(r,n)})}function nt(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function st(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function it(e){return(e>0)-(e<0)||+e}var le=1/3;function at(e){return e<0?-Math.pow(-e,le):Math.pow(e,le)}function ot(e){return Math.exp(e)-1}function ut(e){return Math.log(1+e)}function ht(e){return Math.log(e)/Math.LN2}function m(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||je,cosh:Math.cosh||Le,tanh:Math.tanh||Ue,asinh:Math.asinh||qe,acosh:Math.acosh||Qe,atanh:Math.atanh||De,sqrt:Math.sqrt,cbrt:Math.cbrt||at,log:Math.log,log2:Math.log2||ht,ln:Math.log,lg:Math.log10||oe,log10:Math.log10||oe,expm1:Math.expm1||ot,log1p:Math.log1p||ut,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||Ge,"-":Ve,"+":Number,exp:Math.exp,not:Be,length:Ye,"!":ue,sign:Math.sign||it},this.binaryOps={"+":Me,"-":Ae,"*":Oe,"/":Te,"%":be,"^":Math.pow,"||":ke,"==":_e,"!=":me,">":Ce,"<":Ie,">=":Pe,"<=":Se,and:Ne,or:Re,in:Fe,"=":Ke,"[":We},this.ternaryOps={"?":pe},this.functions={random:$e,fac:ue,min:Ze,max:Je,hypot:Math.hypot||he,pyt:Math.hypot||he,pow:Math.pow,atan2:Math.atan2,if:pe,gamma:ee,roundTo:ze,map:et,fold:tt,filter:rt,indexOf:nt,join:st},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}m.prototype.parse=function(e){var t=[],r=new g(this,new w(this,e),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(t),r.expect(U,"EOF"),new x(t,this)},m.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var fe=new m;m.parse=function(e){return fe.parse(e)},m.evaluate=function(e,t){return fe.parse(e).evaluate(t)};var ce={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function pt(e){return ce.hasOwnProperty(e)?ce[e]:e}m.prototype.isOperatorEnabled=function(e){var t=pt(e),r=this.options.operators||{};return!(t in r)||!!r[t]},window.gform.initializeOnLoaded(function(){const e=window.GFCalc;window.GFCalc=function(t,r){const n=new e(t,r);return n.runCalc=function(s,i){let a=this,u=jQuery("#field_"+i+"_"+s.field_id),h=u.hasClass("gfield_price")?jQuery("#ginput_base_price_"+i+"_"+s.field_id):jQuery("#input_"+i+"_"+s.field_id),v=h.val(),l=gform.applyFilters("gform_calculation_formula",s.formula,s,i,a),f=a.replaceFieldTags(i,l,s).replace(/(\r\n|\n|\r)/gm,""),o="";if(this.exprPatt.test(f))try{o=m.parse(f).evaluate(this.values)}catch{}else return;isFinite(o)||(o=0),window.gform_calculation_result&&(o=window.gform_calculation_result(o,s,i,a),window.console&&console.log('"gform_calculation_result" function is deprecated since version 1.8! Use "gform_calculation_result" JS hook instead.')),o=gform.applyFilters("gform_calculation_result",o,s,i,a);const y=gform.applyFilters("gform_calculation_format_result",!1,o,s,i,a),C=gf_get_field_number_format(s.field_id,i);if(y!==!1)o=y;else if(u.hasClass("gfield_price")||C=="currency")o=gformFormatMoney(o||0,!0);else{let q=".",L=",";C=="decimal_comma"&&(q=",",L="."),o=gformFormatNumber(o,gform.utils.isNumber(s.rounding)?s.rounding:-1,q,L)}o!==v&&(u.hasClass("gfield_price")?(jQuery("#input_"+i+"_"+s.field_id).text(o),h.val(o).trigger("change"),h&&h.length>0&&window.gform.utils.trigger({event:"change",el:h[0],native:!0}),jQuery(".gfield_label_product").length&&!jQuery(".ginput_total").length&&(o=jQuery("label[ for=input_"+i+"_"+s.field_id+"_1 ]").find(".gfield_label_product").text()+" "+o,wp.a11y.speak(o))):h.val(o).trigger("change"))},n}}),jQuery(document).on("gform_post_render",function(e,t,r){jQuery(document).find("[data-style]").each(function(){const s=jQuery(this).data("style");jQuery(this).css(s),jQuery(this).removeAttr("data-style")})}),jQuery(document).on("gform_post_render",function(){gform.addFilter("gform_file_upload_markup",function(e,t,r,n,s,i){const a=/\son([a-z]*)\s*=\s*([\'"])((>\\\\\2|[^\2])*?)\2/g,u=r.settings.multipart_params.form_id,h=r.settings.multipart_params.field_id;return[...e.matchAll(a)].forEach(function(l){const f=l[1];r.bind("UploadComplete",function(){document.querySelector("[data-on"+f+"-handler=upload"+f+"handler_"+u+"_"+h+"]").addEventListener(f,function(){gformDeleteUploadedFile(u,h,this)})})}),e=e.replaceAll(a,' data-on$1-handler="upload$1handler_'+u+"_"+h+'"'),e})})});
